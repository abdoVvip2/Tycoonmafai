<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¨ÙˆØ±ØµØ© ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù‚ÙˆÙ…ÙŠ | Ø£Ø¨Ø§Ø·Ø±Ø© Ø§Ù„Ø³ÙˆÙ‚</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #d4af37; 
            --dark-card: rgba(15, 20, 30, 0.95); 
            --border-gold: rgba(212,175,55, 0.4);
            --red: #ff4d4d; 
            --green: #2ecc71; 
        }
        body { 
            margin: 0; padding: 0; font-family: 'Cairo', sans-serif;
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), 
                        url('https://images.unsplash.com/photo-1497366216548-37526070297c?q=80&w=2000&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: white; height: 100vh; display: flex; flex-direction: column; min-height: 100vh;
        }

        .tabs { 
            display: flex; margin: 20px 12px 10px; background: rgba(0,0,0,0.4); border-radius: 14px; 
            padding: 4px; border: 1px solid var(--border-gold); backdrop-filter: blur(5px);
        }
        .tab { 
            flex: 1; padding: 12px; text-align: center; cursor: pointer; border-radius: 10px; 
            font-weight: bold; color: #aaa; font-size: 0.95rem; 
        }
        .tab.active { background: var(--gold); color: black; }

        .storage-btn {
            margin: 0 12px 10px; padding: 14px; text-align: center; background: rgba(212,175,55,0.2);
            border: 1px solid var(--gold); border-radius: 14px; font-weight: bold; font-size: 1.1rem;
            cursor: pointer; backdrop-filter: blur(5px);
        }

        .main-scroll { flex: 1; overflow-y: auto; padding: 0 12px 80px; position: relative; }

        .view { display: none; }
        .view.active { display: block; }

        .market-card {
            background: var(--dark-card); border-radius: 18px; padding: 16px; margin-bottom: 14px;
            border: 1px solid var(--border-gold); backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        .resource-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .resource-name { font-size: 1.15rem; font-weight: bold; }
        .price-change {
            font-size: 0.9rem; padding: 6px 12px; border-radius: 18px; font-weight: bold;
        }
        .up { background: rgba(46,204,113,0.3); color: var(--green); }
        .down { background: rgba(255,77,77,0.3); color: var(--red); }
        .flat { color: #aaa; background: rgba(255,255,255,0.15); }

        .current-price { font-size: 1.6rem; font-weight: 900; margin: 10px 0; color: var(--gold); }

        .market-supply { 
            font-size: 0.9rem; color: #ddd; margin: 8px 0; text-align: center;
        }

        .trade-section { margin-top: 16px; }
        .trade-input { 
            display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px; 
        }
        .trade-input label { font-size: 0.95rem; white-space: nowrap; }
        .trade-input input {
            width: 100%; max-width: 120px; padding: 10px; background: rgba(0,0,0,0.5); border: 1px solid var(--border-gold);
            border-radius: 10px; color: white; text-align: center; font-size: 1.1rem; outline: none;
        }
        .btn-group { display: flex; gap: 12px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-buy { background: var(--green); color: white; }
        .btn-sell { background: var(--red); color: white; }
        .btn-buy.disabled { background: #555; cursor: not-allowed; opacity: 0.7; }

        .card { 
            background: var(--dark-card); border-radius: 16px; padding: 16px; margin-bottom: 14px;
            border: 1px solid var(--border-gold); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;
        }
        .card-info b { font-size: 1rem; display: block; }
        .card-info small { color: var(--gold); font-size: 0.85rem; }
        .desc { color: #ccc; font-size: 0.8rem; margin-top: 4px; width: 100%; }

        #storage-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 9999;
            display: none; align-items: flex-end; justify-content: center; padding: 20px; 
        }
        .storage-box { 
            background: var(--dark-card); border: 2px solid var(--gold); border-radius: 25px 25px 0 0; 
            width: 100%; max-width: 500px; padding: 25px 20px; backdrop-filter: blur(12px);
            max-height: 80vh; overflow-y: auto;
        }
        .storage-title { color: var(--gold); text-align: center; font-size: 1.3rem; margin-bottom: 20px; }
        .storage-item { 
            display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #333; 
            font-size: 1.05rem;
        }

        #report-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999;
            display: none; align-items: flex-end; justify-content: center; padding: 20px; 
        }
        .report-box { 
            background: var(--dark-card); border: 2px solid var(--gold); border-radius: 25px 25px 0 0; 
            width: 100%; max-width: 500px; padding: 25px 20px; backdrop-filter: blur(10px);
        }
        .report-line { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #333; font-size: 1rem; }

        .bottom-bar { 
            position: fixed; bottom: 0; width: 100%; height: 75px;
            background: #050505; border-top: 1px solid var(--border-gold);
            display: flex; justify-content: space-around; align-items: center;
        }
        .nav-link { 
            text-decoration: none; text-align: center; color: #444; flex: 1; 
        }
        .nav-link.active { color: var(--gold); text-shadow: 0 0 10px var(--gold); }
        .nav-link small { display: block; font-size: 0.7rem; margin-top: 4px; }

        @media (max-width: 480px) {
            .tabs { margin: 20px 10px 8px; }
            .main-scroll { padding: 0 10px 80px; }
            .market-card { padding: 14px; }
            .card { padding: 14px; }
            .resource-name { font-size: 1.1rem; }
            .current-price { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('market')">ğŸ“ˆ Ø§Ù„Ø¨ÙˆØ±ØµØ©</div>
        <div class="tab" onclick="switchTab('factory')">ğŸ­ Ø§Ù„Ø¥Ù†ØªØ§Ø¬</div>
        <div class="tab storage-btn" onclick="openStorage()">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</div>
    </div>

    <div class="main-scroll">
        <div id="page-market" class="view active"></div>

        <div id="page-factory" class="view">
            <div class="card">
                <div class="card-info"><b>âš¡ Ù…Ø­Ø·Ø© Ø·Ø§Ù‚Ø© Ù†ÙˆÙˆÙŠØ©</b><small>+50 Ø·Ø§Ù‚Ø©</small><div class="desc">ØªÙ…Ù„Ùƒ: <span id="h-powerPlants">0</span></div></div>
                <button class="btn btn-buy" onclick="buyAsset('powerPlants', 5000)">Ø¨Ù†Ø§Ø¡ ($5k)</button>
            </div>
            <div class="card">
                <div class="card-info"><b>ğŸ›¢ï¸ Ù…Ù†ØµØ© Ø­ÙØ± Ù†ÙØ·</b><small>Ø·Ù„Ø¨: 10 Ø·Ø§Ù‚Ø© | +20 Ù†ÙØ·</small><div class="desc">ØªÙ…Ù„Ùƒ: <span id="h-oilRigs">0</span></div></div>
                <button class="btn btn-buy" onclick="buyAsset('oilRigs', 8000)">Ø¨Ù†Ø§Ø¡ ($8k)</button>
            </div>
            <div class="card">
                <div class="card-info"><b>ğŸšœ Ù…Ø²Ø±Ø¹Ø© ÙƒØ¨Ø±Ù‰</b><small>Ø·Ù„Ø¨: 5 Ø·Ø§Ù‚Ø© | +40 Ù‚Ù…Ø­</small><div class="desc">ØªÙ…Ù„Ùƒ: <span id="h-farms">0</span></div></div>
                <button class="btn btn-buy" onclick="buyAsset('farms', 4000)">Ø¨Ù†Ø§Ø¡ ($4k)</button>
            </div>
            <div class="card">
                <div class="card-info"><b>â›½ Ù…ØµÙØ§Ø© ØªÙƒØ±ÙŠØ±</b><small>Ø·Ù„Ø¨: 10 Ù†ÙØ· | +10 ÙˆÙ‚ÙˆØ¯</small><div class="desc">ØªÙ…Ù„Ùƒ: <span id="h-refineries">0</span></div></div>
                <button class="btn btn-buy" onclick="buyAsset('refineries', 12000)">Ø¨Ù†Ø§Ø¡ ($12k)</button>
            </div>
            <div class="card">
                <div class="card-info"><b>ğŸ Ù…Ø¬Ù…Ø¹ Ù…Ø®Ø§Ø¨Ø²</b><small>Ø·Ù„Ø¨: 15 Ù‚Ù…Ø­ + 2 ÙˆÙ‚ÙˆØ¯ | +80 Ø®Ø¨Ø²</small><div class="desc">ØªÙ…Ù„Ùƒ: <span id="h-bakeries">0</span></div></div>
                <button class="btn btn-buy" onclick="buyAsset('bakeries', 6000)">Ø¨Ù†Ø§Ø¡ ($6k)</button>
            </div>
        </div>
    </div>

    <div id="storage-overlay" onclick="closeStorage()">
        <div class="storage-box" onclick="event.stopPropagation()">
            <h2 class="storage-title">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ</h2>
            <div id="storage-content"></div>
            <button onclick="closeStorage()" style="width:100%; margin-top:25px; padding:16px; background:var(--gold); border:none; font-weight:900; border-radius:14px; color:black; font-size:1.1rem;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="report-overlay">
        <div class="report-box">
            <h2 style="color:var(--gold); text-align:center; margin-bottom:20px;">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ</h2>
            <div id="report-content"></div>
            <button onclick="closeReport()" style="width:100%; margin-top:25px; padding:16px; background:var(--gold); border:none; font-weight:900; border-radius:14px; color:black; font-size:1.1rem;">Ù…ÙÙ‡ÙˆÙ…</button>
        </div>
    </div>

    <div class="bottom-bar">
        <a href="consol.html" class="nav-link">ğŸ <small>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</small></a>
        <a href="market.html" class="nav-link active">ğŸ“ˆ<small>Ø§Ù„Ø¨ÙˆØ±ØµØ©</small></a>
        <a href="mail.html" class="nav-link">ğŸ“©<small>Ø§Ù„Ø¨Ø±ÙŠØ¯</small></a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, setDoc, serverTimestamp, collection, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDIxOZ_zEKosBgJD2Thn038BFpM25rVGcc",
            authDomain: "tycoon-c3b89.firebaseapp.com",
            projectId: "tycoon-c3b89",
            storageBucket: "tycoon-c3b89.firebasestorage.app",
            messagingSenderId: "534437445544",
            appId: "1:534437445544:web:5f7ea5396367e6b5cca79d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let userRef, userData = {};

        const BASE_PRICES = { power: 12, oil: 55, wheat: 8, fuel: 120, bread: 3 };
        const resources = ['power', 'oil', 'wheat', 'fuel', 'bread'];
        const names = {power:'âš¡ Ø·Ø§Ù‚Ø©', oil:'ğŸ›¢ï¸ Ù†ÙØ·', wheat:'ğŸŒ¾ Ù‚Ù…Ø­', fuel:'â›½ ÙˆÙ‚ÙˆØ¯', bread:'ğŸ Ø®Ø¨Ø²'};

        let todayPrices = {};
        let yesterdayPrices = {};
        let marketSupply = {};

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userRef = doc(db, "players", user.uid);
                const snap = await getDoc(userRef);
                if (snap.exists()) {
                    userData = snap.data();
                    await loadDailyPricesAndGlobalSupply();
                    updateUI();
                    checkProductionSimulation();
                }
            } else {
                window.location.href = 'home.html';
            }
        });

        function getDateKey(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        async function loadDailyPricesAndGlobalSupply() {
            try {
                const todayKey = getDateKey(new Date());
                const pricesCol = collection(db, "market_daily_prices");
                const pricesSnap = await getDocs(pricesCol);

                let todayFound = false;
                pricesSnap.forEach(docSnap => { if (docSnap.id === todayKey) { todayPrices = docSnap.data(); todayFound = true; } });

                if (!todayFound) {
                    todayPrices = {};
                    resources.forEach(res => {
                        const change = (Math.random() - 0.5) * 0.3;
                        todayPrices[res] = Math.max(Math.round(BASE_PRICES[res] * (1 + change) * 100) / 100, BASE_PRICES[res] * 0.5);
                    });
                    await setDoc(doc(db, "market_daily_prices", todayKey), { ...todayPrices, date: todayKey, timestamp: serverTimestamp() });
                }

                // Ø¬Ù„Ø¨ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØ±ØµØ© Ø§Ù„Ø«Ø§Ø¨ØªØ© (Ù„Ø§ ØªØªØºÙŠØ± Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®)
                const supplyDoc = await getDoc(doc(db, "market_settings", "global_supply"));
                if (supplyDoc.exists()) {
                    marketSupply = supplyDoc.data();
                } else {
                    marketSupply = { power: 50000, oil: 20000, wheat: 80000, fuel: 15000, bread: 100000 };
                    await setDoc(doc(db, "market_settings", "global_supply"), marketSupply);
                }

                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayKey = getDateKey(yesterday);
                pricesSnap.forEach(docSnap => { if (docSnap.id === yesterdayKey) { yesterdayPrices = docSnap.data(); } });
                if (!yesterdayPrices.power) yesterdayPrices = BASE_PRICES;

            } catch (error) {
                todayPrices = BASE_PRICES; yesterdayPrices = BASE_PRICES;
            }
            renderMarket();
        }

        function renderMarket() {
            let html = '';
            resources.forEach(res => {
                const current = todayPrices[res] || BASE_PRICES[res];
                const prev = yesterdayPrices[res] || BASE_PRICES[res];
                const change = ((current - prev) / prev) * 100;
                const arrow = change > 0 ? 'â†‘' : change < 0 ? 'â†“' : 'â†’';
                const changeClass = change > 0 ? 'up' : change < 0 ? 'down' : 'flat';
                const remaining = marketSupply[res] || 0;

                html += `<div class="market-card">
                    <div class="resource-header">
                        <div class="resource-name">${names[res]}</div>
                        <div class="price-change ${changeClass}">${arrow} ${Math.abs(change).toFixed(1)}%</div>
                    </div>
                    <div class="current-price">$${current.toFixed(2)}</div>
                    <div class="market-supply">Ø§Ù„Ù…ØªÙˆÙØ± Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹: <strong>${Math.floor(remaining).toLocaleString('en-US')}</strong> ÙˆØ­Ø¯Ø©</div>
                    <div class="trade-section">
                        <div class="trade-input"><label>Ø§Ù„ÙƒÙ…ÙŠØ©:</label><input type="number" id="qty-${res}" value="1" min="1"></div>
                        <div class="btn-group">
                            <button class="btn btn-buy${remaining > 0 ? '' : ' disabled'}" onclick="trade('${res}', 'buy')">${remaining > 0 ? 'Ø´Ø±Ø§Ø¡' : 'Ù†ÙØ¯'}</button>
                            <button class="btn btn-sell" onclick="trade('${res}', 'sell')">Ø¨ÙŠØ¹</button>
                        </div>
                    </div>
                </div>`;
            });
            document.getElementById('page-market').innerHTML = html;
        }

        async function trade(res, action) {
            const qty = parseInt(document.getElementById(`qty-${res}`).value) || 0;
            if (qty < 1) return;
            const price = todayPrices[res] || BASE_PRICES[res];
            const total = price * qty;

            if (action === 'buy') {
                if (qty > (marketSupply[res]||0) || userData.balance < total) { alert("ÙØ´Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: Ø±ØµÙŠØ¯ Ø£Ùˆ ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©"); return; }
                userData.balance -= total; userData[res] = (userData[res] || 0) + qty; marketSupply[res] -= qty;
            } else {
                if ((userData[res] || 0) < qty) { alert("Ù…Ø®Ø²ÙˆÙ†Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ"); return; }
                userData.balance += Math.floor(total * 0.95); userData[res] -= qty; marketSupply[res] += qty;
            }
            await updateDoc(userRef, userData);
            await updateDoc(doc(db, "market_settings", "global_supply"), { [res]: marketSupply[res] });
            updateUI(); renderMarket();
        }

        async function checkProductionSimulation() {
            const now = new Date();
            // ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± (UTC+1)
            const algeriaTime = new Date(now.getTime() + (1 * 60 * 60 * 1000));
            const dayKey = getDateKey(algeriaTime);
            const hour = algeriaTime.getUTCHours();
            const slot = hour < 12 ? "AM" : "PM";
            const lastSimKey = `${dayKey}_${slot}`;

            if (userData.lastSimKey !== lastSimKey) {
                let u = { ...userData, lastSimKey: lastSimKey };
                let log = [];
                let pop = u.population || 1000;
                let breadReq = Math.ceil(pop / 20); // Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø®Ø¨Ø² Ù…Ø±ØªÙŠÙ† ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ù„Ø°Ø§ Ù†Ù‚Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬

                // Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø®Ø¨Ø² ÙˆØ§Ù„Ù†Ù…Ùˆ
                if ((u.bread || 0) >= breadReq) {
                    u.bread -= breadReq; u.population += Math.floor(pop * 0.01);
                    log.push(`<div class="report-line"><span>ğŸ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø®Ø¨Ø² (${slot})</span><span style="color:var(--green)">-${breadReq}</span></div>`);
                } else {
                    let loss = Math.floor(pop * 0.05); u.population -= loss; u.bread = 0;
                    log.push(`<div class="report-line"><span>ğŸ’€ Ù…Ø¬Ø§Ø¹Ø© (${slot})</span><span style="color:var(--red)">-${loss}</span></div>`);
                }

                // Ø¯ÙˆØ±Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬
                u.power = (u.power || 0) + (u.powerPlants || 0) * 50;
                let energyNeed = ((u.oilRigs||0)*10 + (u.farms||0)*5);
                if (u.power >= energyNeed) {
                    u.power -= energyNeed;
                    u.oil = (u.oil || 0) + (u.oilRigs||0)*20; 
                    u.wheat = (u.wheat || 0) + (u.farms||0)*40;
                }
                if (u.oil >= (u.refineries||0)*10) { 
                    u.oil -= (u.refineries||0)*10; u.fuel = (u.fuel || 0) + (u.refineries||0)*10; 
                }
                if (u.wheat >= (u.bakeries||0)*15 && u.fuel >= (u.bakeries||0)*2) {
                    u.wheat -= (u.bakeries||0)*15; u.fuel -= (u.bakeries||0)*2; u.bread = (u.bread || 0) + (u.bakeries||0)*80;
                }

                log.push(`<div class="report-line"><span>âš™ï¸ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø¯ÙˆØ±ÙŠ</span><span style="color:var(--gold)">Ø§ÙƒØªÙ…Ù„</span></div>`);
                document.getElementById('report-content').innerHTML = log.join('');
                document.getElementById('report-overlay').style.display = 'flex';
                await updateDoc(userRef, u); userData = u; updateUI();
            }
        }

        async function buyAsset(id, cost) {
            if (userData.balance >= cost) {
                userData.balance -= cost; userData[id] = (userData[id] || 0) + 1;
                await updateDoc(userRef, { balance: userData.balance, [id]: increment(1) });
                updateUI();
            } else { alert("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ!"); }
        }

        function updateUI() {
            ['powerPlants','oilRigs','farms','refineries','bakeries'].forEach(k => {
                const el = document.getElementById('h-'+k); if (el) el.innerText = userData[k] || 0;
            });
        }

        function switchTab(tab) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
            document.getElementById('page-' + tab).classList.add('active');
            document.querySelectorAll('.tab')[tab === 'market' ? 0 : 1].classList.add('active');
        }

        function openStorage() {
            let content = `<div class="storage-item" style="background:rgba(212,175,55,0.1); padding:10px; border-radius:8px; margin-bottom:10px;"><span>ğŸ’° Ø§Ù„Ø®Ø²ÙŠÙ†Ø©</span><span><strong>$${(userData.balance || 0).toLocaleString('en-US')}</strong></span></div>
                           <div class="storage-item" style="background:rgba(212,175,55,0.1); padding:10px; border-radius:8px; margin-bottom:15px;"><span>ğŸ‘¥ Ø§Ù„Ø³ÙƒØ§Ù†</span><span><strong>${(userData.population || 0).toLocaleString('en-US')}</strong></span></div>`;
            resources.forEach(res => {
                content += `<div class="storage-item"><span>${names[res]}</span><span><strong>${(userData[res] || 0).toLocaleString('en-US')}</strong> ÙˆØ­Ø¯Ø©</span></div>`;
            });
            document.getElementById('storage-content').innerHTML = content;
            document.getElementById('storage-overlay').style.display = 'flex';
        }

        window.trade = trade; window.buyAsset = buyAsset; window.switchTab = switchTab;
        window.closeReport = () => document.getElementById('report-overlay').style.display = 'none';
        window.openStorage = openStorage; window.closeStorage = () => document.getElementById('storage-overlay').style.display = 'none';
    </script>
</body>
</html>
